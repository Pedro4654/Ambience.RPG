{"version":3,"sources":["dice/environment.dds","hooks/usePreventTouch.ts","components/dice/DiceInteraction.tsx","dice/shared/d4.glb","dice/shared/d6.glb","dice/shared/d8.glb","dice/shared/d10.glb","dice/shared/d12.glb","dice/shared/d20.glb","dice/shared/d100.glb","helpers/babylon.ts","types/Dice.ts","dice/Dice.ts","icons/ExpandMoreDiceTrayIcon.tsx","icons/ShareDiceOnIcon.tsx","icons/ShareDiceOffIcon.tsx","components/dice/DiceButtonCount.tsx","components/dice/DiceButton.tsx","icons/SelectDiceIcon.tsx","components/dice/DiceTile.tsx","components/dice/DiceTiles.tsx","dice/galaxy/albedo.jpg","dice/galaxy/metalRoughness.jpg","dice/galaxy/normal.jpg","dice/galaxy/GalaxyDice.ts","dice/iron/albedo.jpg","dice/iron/metalRoughness.jpg","dice/iron/normal.jpg","dice/iron/IronDice.ts","dice/nebula/albedo.jpg","dice/nebula/metalRoughness.jpg","dice/nebula/normal.jpg","dice/nebula/NebulaDice.ts","dice/sunrise/albedo.jpg","dice/sunrise/metalRoughness.jpg","dice/sunrise/normal.jpg","dice/sunrise/SunriseDice.ts","dice/sunset/albedo.jpg","dice/sunset/metalRoughness.jpg","dice/sunset/normal.jpg","dice/sunset/SunsetDice.ts","dice/walnut/albedo.jpg","dice/walnut/metalRoughness.jpg","dice/walnut/normal.jpg","dice/walnut/WalnutDice.ts","dice/walnut/d4.glb","dice/walnut/d6.glb","dice/walnut/d8.glb","dice/walnut/d10.glb","dice/walnut/d12.glb","dice/walnut/d20.glb","dice/walnut/d100.glb","dice/glass/albedo.jpg","dice/glass/mask.png","dice/glass/normal.jpg","dice/glass/GlassDice.ts","dice/gemstone/albedo.jpg","dice/gemstone/metalRoughness.jpg","dice/gemstone/normal.jpg","dice/gemstone/GemstoneDice.ts","dice/galaxy/preview.png","dice/iron/preview.png","dice/nebula/preview.png","dice/sunrise/preview.png","dice/sunset/preview.png","dice/walnut/preview.png","dice/glass/preview.png","dice/gemstone/preview.png","dice/index.ts","modals/SelectDiceModal.tsx","components/dice/SelectDiceButton.tsx","components/dice/DiceButtons.tsx","icons/ClearDiceIcon.tsx","icons/RerollDiceIcon.tsx","components/dice/DiceResults.tsx","dice/diceTray/single.glb","dice/diceTray/double.glb","dice/diceTray/singleAlbedo.jpg","dice/diceTray/singleMetalRoughness.jpg","dice/diceTray/singleNormal.jpg","dice/diceTray/doubleAlbedo.jpg","dice/diceTray/doubleMetalRoughness.jpg","dice/diceTray/doubleNormal.jpg","dice/diceTray/DiceTray.ts","components/dice/DiceTrayOverlay.tsx"],"names":["usePreventTouch","elementRef","useEffect","prevent3DTouch","event","preventDefault","element","current","addEventListener","removeEventListener","DiceInteraction","onSceneMount","onPointerDown","onPointerUp","useState","error","setError","sceneRef","useRef","engineRef","canvasRef","containerRef","canvas","engine","Engine","isSafari","preserveDrawingBuffer","stencil","xrCompatible","scene","Scene","clearColor","Color4","Ammo","then","enablePhysics","Vector3","AmmoJSPlugin","camera","TargetCamera","fov","setTarget","Zero","runRenderLoop","selectedMesh","selectedMeshRef","ray","createPickingRay","pointerX","pointerY","Matrix","Identity","currentPosition","getAbsolutePosition","newPosition","origin","scale","globalPosition","y","delta","subtract","setAbsolutePosition","velocity","deltaTime","selectedMeshVelocityWindowRef","slice","Math","max","length","selectedMeshVelocityWindowSize","push","Error","selectedMeshMassRef","handlePointerUp","velocityWindow","v","addInPlace","scaleInPlace","physicsImpostor","setMass","forceUpdate","applyImpulse","mass","getObjectCenter","style","width","height","position","overflow","ref","handleWidth","handleHeight","onResize","resize","targetRef","pickInfo","pick","hit","pickedMesh","name","setLinearVelocity","setAngularVelocity","onPointerCancel","onPointerLeave","outline","ErrorBanner","onRequestClose","undefined","defaultProps","importTextureAsync","url","a","Promise","resolve","reject","texture","Texture","isDiceMeshes","meshes","d4","d6","d8","d10","d12","d20","d100","Dice","material","sourceOverrides","addToMeshes","type","defaultSource","source","loadMesh","mesh","all","d4Source","d6Source","d8Source","d10Source","d12Source","d20Source","d100Source","SceneLoader","ImportMeshAsync","setParent","receiveShadows","isVisible","materialName","textures","pbr","PBRMaterial","albedo","normal","metalRoughness","albedoTexture","bumpTexture","metallicTexture","useRoughnessFromMetallicTextureAlpha","useRoughnessFromMetallicTextureGreen","useMetallnessFromMetallicTextureBlue","physicalProperties","instance","createInstance","getChildTransformNodes","child","locator","clone","addChild","PhysicsImpostor","ConvexHullImpostor","diceType","friction","getScene","diceTraySingle","getMeshByID","diceTrayDouble","visibleDiceTray","trayBounds","getBoundingInfo","boundingBox","center","x","random","z","addRotation","PI","throwTarget","lerp","minimumWorld","maximumWorld","impulse","normalizeToNew","this","instanceCount","createInstanceFromMesh","ExpandMoreDotIcon","xmlns","viewBox","fill","d","ShareDiceOnIcon","ShareDiceOffIcon","DiceButtonCount","children","sx","top","right","transform","display","alignItems","variant","as","color","fontSize","fontWeight","DiceButton","title","count","onClick","disabled","aria-label","SelectDiceIcon","DiceTile","dice","isSelected","onDiceSelect","onDone","cursor","Tile","onSelect","onDoubleClick","src","preview","DiceTiles","selectedDice","layout","useResponsiveLayout","tileContainerHeight","p","pb","bg","borderRadius","minHeight","screenSize","gap","columns","tileGridColumns","map","key","GalaxyDice","loadMaterial","loadMeshes","getDicePhysicalProperties","IronDice","properties","createInstanceMesh","NebulaDice","SunriseDice","SunsetDice","WalnutDice","GlassDice","mask","roughness","metallic","subSurface","isRefractionEnabled","indexOfRefraction","refractionIntensity","isTranslucencyEnabled","translucencyIntensity","minimumThickness","maximumThickness","tintColor","Color3","thicknessTexture","useMaskFromThicknessTexture","loadGlassMaterial","GemstoneDice","diceClasses","galaxy","nebula","sunrise","sunset","iron","walnut","glass","gemstone","dicePreviews","GalaxyPreview","NebulaPreview","SunrisePreview","SunsetPreview","IronPreview","WalnutPreview","GlassPreview","GemstonePreview","Object","keys","Case","capital","class","SelectDiceModal","isOpen","defaultDice","setSelectedDice","Modal","content","maxWidth","modalSize","flexDirection","pt","my","SelectDiceButton","onDiceChange","currentDice","isModalOpen","setIsModalOpen","closeModal","DiceButtons","diceRolls","onDiceAdd","onDiceLoad","diceTraySize","onDiceTraySizeChange","shareDice","onShareDiceChange","loading","useSetting","currentDiceStyle","setCurrentDiceStyle","find","setCurrentDice","initialDice","diceCounts","buttons","D20Icon","D12Icon","D10Icon","D8Icon","D6Icon","D4Icon","D100Icon","left","maxHeight","pointerEvents","justifyContent","Divider","button","ExpandMoreDiceTrayIcon","ClearDiceIcon","RerollDiceIcon","DiceResults","onDiceClear","onDiceReroll","isExpanded","setIsExpanded","rolls","filter","roll","index","Fragment","bottom","ml","userSelect","getDiceRollTotal","mr","DiceTray","initialSize","shadowGenerator","_size","collisionSize","wallTop","wallRight","wallBottom","wallLeft","singleMesh","doubleMesh","newSize","wallOffsetWidth","wallOffsetHeight","size","loadWalls","collision","Mesh","CreateBox","DOUBLESIDE","BoxImpostor","createCollision","singleMeshSource","doubleMeshSource","singleAlbedo","singleNormal","singleMetalRoughness","doubleAlbedo","doubleNormal","doubleMetalRoughness","singleMeshes","doubleMeshes","singleAlbedoTexture","singleNormalTexture","singleMetalRoughnessTexture","doubleAlbedoTexture","doubleNormalTexture","doubleMetalRoughnessTexture","id","singleMaterial","addShadowCaster","doubleMaterial","DiceTrayOverlay","onDiceRollsChange","shadowGeneratorRef","diceRefs","sceneVisibleRef","sceneInteractionRef","sceneKeepAwakeRef","diceTrayRef","setDiceTraySize","useDiceLoading","assetLoadStart","assetLoadFinish","isLoading","fullScreen","handleAssetLoadStart","handleAssetLoadFinish","forceRender","triggered","timeout","setTimeout","clearTimeout","cleanup","diceTray","handleSceneMount","useCallback","initializeScene","update","light","DirectionalLight","shadowMinZ","shadowMaxZ","ShadowGenerator","useCloseExponentialShadowMap","darkness","environmentTexture","CubeTexture","CreateFromPrefilteredData","environment","environmentIntensity","load","die","forceSceneRender","sceneInteraction","diceAwake","asleep","includes","i","speed","diceSpeed","getLinearVelocity","d10Instance","d10Speed","getDiceSpeed","sleepTimeout","render","traySize","setTraySize","renderTimeout","renderCleanup","handleResize","document","querySelector","mapRect","getBoundingClientRect","availableWidth","availableHeight","min","window","updateInterval","setInterval","newRolls","getDiceRoll","clearInterval","dispose","handleDiceClear","handleDiceAdd","LoadingOverlay"],"mappings":"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","file":"static/js/8.1a397187.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/environment.6140ab69.dds\";","import { useEffect } from \"react\";\r\n\r\nfunction usePreventTouch(elementRef: React.RefObject<HTMLElement>) {\r\n  useEffect(() => {\r\n    // Stop 3d touch\r\n    function prevent3DTouch(event: TouchEvent) {\r\n      event.preventDefault();\r\n    }\r\n    const element = elementRef.current;\r\n    if (element) {\r\n      element.addEventListener(\"touchstart\", prevent3DTouch, false);\r\n    }\r\n\r\n    return () => {\r\n      if (element) {\r\n        element.removeEventListener(\"touchstart\", prevent3DTouch);\r\n      }\r\n    };\r\n  }, [elementRef]);\r\n}\r\n\r\nexport default usePreventTouch;\r\n","import { useRef, useEffect, useState } from \"react\";\r\nimport { Engine } from \"@babylonjs/core/Engines/engine\";\r\nimport { Scene } from \"@babylonjs/core/scene\";\r\nimport { Vector3, Color4, Matrix } from \"@babylonjs/core/Maths/math\";\r\nimport { AmmoJSPlugin } from \"@babylonjs/core/Physics/Plugins/ammoJSPlugin\";\r\nimport { TargetCamera } from \"@babylonjs/core/Cameras/targetCamera\";\r\nimport Ammo from \"ammo.js\";\r\n\r\nimport \"@babylonjs/core/Physics/physicsEngineComponent\";\r\nimport \"@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent\";\r\nimport \"@babylonjs/core/Materials/Textures/Loaders/ddsTextureLoader\";\r\nimport \"@babylonjs/core/Meshes/Builders/boxBuilder\";\r\nimport \"@babylonjs/core/Actions/actionManager\";\r\nimport \"@babylonjs/core/Culling/ray\";\r\nimport \"@babylonjs/loaders/glTF\";\r\n\r\nimport ReactResizeDetector from \"react-resize-detector\";\r\n\r\nimport usePreventTouch from \"../../hooks/usePreventTouch\";\r\n\r\nimport ErrorBanner from \"../banner/ErrorBanner\";\r\nimport { AbstractMesh } from \"@babylonjs/core/Meshes/abstractMesh\";\r\nimport { isSafari } from \"../../helpers/shared\";\r\n\r\nconst diceThrowSpeed = 2;\r\n\r\ntype SceneMountEvent = {\r\n  scene: Scene;\r\n  engine: Engine;\r\n  canvas: HTMLCanvasElement;\r\n};\r\n\r\ntype SceneMountEventHandler = (event: SceneMountEvent) => void;\r\n\r\ntype DiceInteractionProps = {\r\n  onSceneMount?: SceneMountEventHandler;\r\n  onPointerDown: () => void;\r\n  onPointerUp: () => void;\r\n};\r\n\r\nfunction DiceInteraction({\r\n  onSceneMount,\r\n  onPointerDown,\r\n  onPointerUp,\r\n}: DiceInteractionProps) {\r\n  const [error, setError] = useState<Error | undefined>();\r\n\r\n  const sceneRef = useRef<Scene>();\r\n  const engineRef = useRef<Engine>();\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // iOS 15.4 introduced a bug - animation trails ar visible on dice in Safari. Have to disable antialiasing on Safari\r\n      // https://forum.babylonjs.com/t/render-loop-issue-on-iphone-11-unwanted-animation-trails/29742\r\n      const engine = new Engine(canvas, !isSafari, {\r\n        preserveDrawingBuffer: true,\r\n        stencil: true,\r\n        // Prevent XR from loading as Safari 15 crashes with this enabled\r\n        // TODO: Remove when https://github.com/BabylonJS/Babylon.js/pull/11121/files released\r\n        xrCompatible: false\r\n      });\r\n      const scene = new Scene(engine);\r\n      scene.clearColor = new Color4(0, 0, 0, 0);\r\n      // Enable physics\r\n      Ammo().then(() => {\r\n        scene.enablePhysics(new Vector3(0, -98, 0), new AmmoJSPlugin(false));\r\n      });\r\n\r\n      let camera = new TargetCamera(\"camera\", new Vector3(0, 33.5, 0), scene);\r\n      camera.fov = 0.65;\r\n      camera.setTarget(Vector3.Zero());\r\n\r\n      onSceneMount && onSceneMount({ scene, engine, canvas });\r\n\r\n      engineRef.current = engine;\r\n      sceneRef.current = scene;\r\n\r\n      engine.runRenderLoop(() => {\r\n        const scene = sceneRef.current;\r\n        const selectedMesh = selectedMeshRef.current;\r\n        if (selectedMesh && scene) {\r\n          const ray = scene.createPickingRay(\r\n            scene.pointerX,\r\n            scene.pointerY,\r\n            Matrix.Identity(),\r\n            camera\r\n          );\r\n          const currentPosition = selectedMesh.getAbsolutePosition();\r\n          let newPosition = ray.origin.scale(camera.globalPosition.y);\r\n          newPosition.y = currentPosition.y;\r\n          const delta = newPosition.subtract(currentPosition);\r\n          selectedMesh.setAbsolutePosition(newPosition);\r\n          const velocity = delta.scale(1000 / scene.deltaTime);\r\n          selectedMeshVelocityWindowRef.current =\r\n            selectedMeshVelocityWindowRef.current.slice(\r\n              Math.max(\r\n                selectedMeshVelocityWindowRef.current.length -\r\n                  selectedMeshVelocityWindowSize,\r\n                0\r\n              )\r\n            );\r\n          selectedMeshVelocityWindowRef.current.push(velocity);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        setError(error);\r\n      }\r\n    }\r\n  }, [onSceneMount]);\r\n\r\n  const selectedMeshRef = useRef<AbstractMesh | null>(null);\r\n  const selectedMeshVelocityWindowRef = useRef<Vector3[]>([]);\r\n  const selectedMeshVelocityWindowSize = 4;\r\n  const selectedMeshMassRef = useRef<number>(0);\r\n  function handlePointerDown() {\r\n    const scene = sceneRef.current;\r\n    if (scene) {\r\n      const pickInfo = scene.pick(scene.pointerX, scene.pointerY);\r\n      if (\r\n        pickInfo &&\r\n        pickInfo.hit &&\r\n        pickInfo.pickedMesh &&\r\n        pickInfo.pickedMesh.name !== \"dice_tray\"\r\n      ) {\r\n        pickInfo.pickedMesh.physicsImpostor?.setLinearVelocity(Vector3.Zero());\r\n        pickInfo.pickedMesh.physicsImpostor?.setAngularVelocity(Vector3.Zero());\r\n\r\n        // Save the meshes mass and set it to 0 so we can pick it up\r\n        selectedMeshMassRef.current =\r\n          pickInfo.pickedMesh.physicsImpostor?.mass || 0;\r\n        pickInfo.pickedMesh.physicsImpostor?.setMass(0);\r\n\r\n        selectedMeshRef.current = pickInfo.pickedMesh;\r\n      }\r\n    }\r\n    onPointerDown();\r\n  }\r\n\r\n  function handlePointerUp() {\r\n    const selectedMesh = selectedMeshRef.current;\r\n    const velocityWindow = selectedMeshVelocityWindowRef.current;\r\n    const scene = sceneRef.current;\r\n    if (selectedMesh && scene) {\r\n      // Average velocity window\r\n      let velocity = Vector3.Zero();\r\n      for (let v of velocityWindow) {\r\n        velocity.addInPlace(v);\r\n      }\r\n      if (velocityWindow.length > 0) {\r\n        velocity.scaleInPlace(1 / velocityWindow.length);\r\n      }\r\n\r\n      // Re-apply the meshes mass\r\n      selectedMesh.physicsImpostor?.setMass(selectedMeshMassRef.current);\r\n      selectedMesh.physicsImpostor?.forceUpdate();\r\n\r\n      selectedMesh.physicsImpostor?.applyImpulse(\r\n        velocity.scale(diceThrowSpeed * selectedMesh.physicsImpostor.mass),\r\n        selectedMesh.physicsImpostor.getObjectCenter()\r\n      );\r\n    }\r\n    selectedMeshRef.current = null;\r\n    selectedMeshVelocityWindowRef.current = [];\r\n    selectedMeshMassRef.current = 0;\r\n\r\n    onPointerUp();\r\n  }\r\n\r\n  function handleResize(width?: number, height?: number) {\r\n    if (width && height) {\r\n      const engine = engineRef.current;\r\n      if (engine && canvasRef.current) {\r\n        engine.resize();\r\n        canvasRef.current.width = width;\r\n        canvasRef.current.height = height;\r\n      }\r\n    }\r\n  }\r\n\r\n  usePreventTouch(containerRef);\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        position: \"absolute\",\r\n        overflow: \"hidden\",\r\n      }}\r\n      ref={containerRef}\r\n    >\r\n      <ReactResizeDetector\r\n        handleWidth\r\n        handleHeight\r\n        onResize={handleResize}\r\n        targetRef={containerRef}\r\n      >\r\n        <canvas\r\n          onPointerDown={handlePointerDown}\r\n          onPointerUp={handlePointerUp}\r\n          onPointerCancel={handlePointerUp}\r\n          onPointerLeave={handlePointerUp}\r\n          ref={canvasRef}\r\n          style={{ outline: \"none\" }}\r\n        />\r\n      </ReactResizeDetector>\r\n      <ErrorBanner error={error} onRequestClose={() => setError(undefined)} />\r\n    </div>\r\n  );\r\n}\r\n\r\nDiceInteraction.defaultProps = {\r\n  onPointerDown() {},\r\n  onPointerUp() {},\r\n};\r\n\r\nexport default DiceInteraction;\r\n","export default __webpack_public_path__ + \"static/media/d4.5f4a6b12.glb\";","export default __webpack_public_path__ + \"static/media/d6.01277ab0.glb\";","export default __webpack_public_path__ + \"static/media/d8.aef4e07e.glb\";","export default __webpack_public_path__ + \"static/media/d10.75162417.glb\";","export default __webpack_public_path__ + \"static/media/d12.0acb683a.glb\";","export default __webpack_public_path__ + \"static/media/d20.8be40bdc.glb\";","export default __webpack_public_path__ + \"static/media/d100.f247533e.glb\";","import { Texture } from \"@babylonjs/core/Materials/Textures/texture\";\r\n\r\n// Turn texture load into an async function so it can be awaited\r\nexport async function importTextureAsync(url: string): Promise<Texture> {\r\n  return new Promise((resolve, reject) => {\r\n    let texture = new Texture(\r\n      url,\r\n      null,\r\n      undefined,\r\n      false,\r\n      undefined,\r\n      () => {\r\n        resolve(texture);\r\n      },\r\n      () => {\r\n        reject(\"Unable to load texture\");\r\n      }\r\n    );\r\n  });\r\n}\r\n","import { InstancedMesh, Mesh } from \"@babylonjs/core\";\r\nimport Dice from \"../dice/Dice\";\r\n\r\nexport type DiceType = \"d4\" | \"d6\" | \"d8\" | \"d10\" | \"d12\" | \"d20\" | \"d100\";\r\n\r\nexport type DiceRoll = {\r\n  type: DiceType;\r\n  roll: number | \"unknown\";\r\n};\r\n\r\nexport type DiceMesh = {\r\n  type: DiceType;\r\n  instance: InstancedMesh;\r\n  asleep: boolean;\r\n  sleepTimeout?: NodeJS.Timeout;\r\n  d10Instance?: InstancedMesh;\r\n};\r\n\r\nexport type DiceState = {\r\n  share: boolean;\r\n  rolls: DiceRoll[];\r\n};\r\n\r\nexport type DefaultDice = {\r\n  key: string;\r\n  name: string;\r\n  class: typeof Dice;\r\n  preview: string;\r\n};\r\n\r\nexport type BaseDiceTextureSources = {\r\n  albedo: string;\r\n  normal: string;\r\n  metalRoughness: string;\r\n};\r\n\r\nexport type DiceMeshes = Record<DiceType, Mesh>;\r\n\r\nexport function isDiceMeshes(\r\n  meshes: Partial<DiceMeshes>\r\n): meshes is DiceMeshes {\r\n  return (\r\n    !!meshes.d4 &&\r\n    !!meshes.d6 &&\r\n    !!meshes.d8 &&\r\n    !!meshes.d10 &&\r\n    !!meshes.d12 &&\r\n    !!meshes.d20 &&\r\n    !!meshes.d100\r\n  );\r\n}\r\n","import { Vector3 } from \"@babylonjs/core/Maths/math\";\r\nimport { SceneLoader } from \"@babylonjs/core/Loading/sceneLoader\";\r\nimport { PBRMaterial } from \"@babylonjs/core/Materials/PBR/pbrMaterial\";\r\nimport {\r\n  PhysicsImpostor,\r\n  PhysicsImpostorParameters,\r\n} from \"@babylonjs/core/Physics/physicsImpostor\";\r\n\r\nimport d4Source from \"./shared/d4.glb\";\r\nimport d6Source from \"./shared/d6.glb\";\r\nimport d8Source from \"./shared/d8.glb\";\r\nimport d10Source from \"./shared/d10.glb\";\r\nimport d12Source from \"./shared/d12.glb\";\r\nimport d20Source from \"./shared/d20.glb\";\r\nimport d100Source from \"./shared/d100.glb\";\r\n\r\nimport { lerp } from \"../helpers/shared\";\r\nimport { importTextureAsync } from \"../helpers/babylon\";\r\nimport {\r\n  AbstractMesh,\r\n  InstancedMesh,\r\n  Material,\r\n  Mesh,\r\n  Scene,\r\n} from \"@babylonjs/core\";\r\nimport {\r\n  DiceType,\r\n  BaseDiceTextureSources,\r\n  isDiceMeshes,\r\n  DiceMeshes,\r\n} from \"../types/Dice\";\r\n\r\nconst minDiceRollSpeed = 600;\r\nconst maxDiceRollSpeed = 800;\r\n\r\nclass Dice {\r\n  static instanceCount = 0;\r\n\r\n  static async loadMeshes(\r\n    material: Material,\r\n    scene: Scene,\r\n    sourceOverrides?: Record<DiceType, string>\r\n  ): Promise<DiceMeshes> {\r\n    let meshes: Partial<DiceMeshes> = {};\r\n    const addToMeshes = async (type: DiceType, defaultSource: string) => {\r\n      let source = sourceOverrides ? sourceOverrides[type] : defaultSource;\r\n      const mesh = await this.loadMesh(source, material, scene);\r\n      meshes[type] = mesh;\r\n    };\r\n    await Promise.all([\r\n      addToMeshes(\"d4\", d4Source),\r\n      addToMeshes(\"d6\", d6Source),\r\n      addToMeshes(\"d8\", d8Source),\r\n      addToMeshes(\"d10\", d10Source),\r\n      addToMeshes(\"d12\", d12Source),\r\n      addToMeshes(\"d20\", d20Source),\r\n      addToMeshes(\"d100\", d100Source),\r\n    ]);\r\n    if (isDiceMeshes(meshes)) {\r\n      return meshes;\r\n    } else {\r\n      throw new Error(\"Dice meshes failed to load, missing mesh source\");\r\n    }\r\n  }\r\n\r\n  static async loadMesh(source: string, material: Material, scene: Scene) {\r\n    let mesh = (await SceneLoader.ImportMeshAsync(\"\", source, \"\", scene))\r\n      .meshes[1] as Mesh;\r\n    mesh.setParent(null);\r\n\r\n    mesh.material = material;\r\n\r\n    mesh.receiveShadows = true;\r\n    mesh.isVisible = false;\r\n    return mesh;\r\n  }\r\n\r\n  static async loadMaterial(\r\n    materialName: string,\r\n    textures: BaseDiceTextureSources,\r\n    scene: Scene\r\n  ) {\r\n    let pbr = new PBRMaterial(materialName, scene);\r\n    let [albedo, normal, metalRoughness] = await Promise.all([\r\n      importTextureAsync(textures.albedo),\r\n      importTextureAsync(textures.normal),\r\n      importTextureAsync(textures.metalRoughness),\r\n    ]);\r\n    pbr.albedoTexture = albedo;\r\n    pbr.bumpTexture = normal;\r\n    pbr.metallicTexture = metalRoughness;\r\n    pbr.useRoughnessFromMetallicTextureAlpha = false;\r\n    pbr.useRoughnessFromMetallicTextureGreen = true;\r\n    pbr.useMetallnessFromMetallicTextureBlue = true;\r\n    return pbr;\r\n  }\r\n\r\n  static createInstanceFromMesh(\r\n    mesh: Mesh,\r\n    name: string,\r\n    physicalProperties: PhysicsImpostorParameters,\r\n    scene: Scene\r\n  ) {\r\n    let instance = mesh.createInstance(name);\r\n    instance.position = mesh.position;\r\n    for (let child of mesh.getChildTransformNodes()) {\r\n      const locator = child.clone(child.name, instance);\r\n      if (!locator) {\r\n        throw new Error(\"Unable to clone dice locator\");\r\n      }\r\n      locator.setAbsolutePosition(child.getAbsolutePosition());\r\n      locator.name = child.name;\r\n      instance.addChild(locator as AbstractMesh);\r\n    }\r\n\r\n    instance.physicsImpostor = new PhysicsImpostor(\r\n      instance,\r\n      PhysicsImpostor.ConvexHullImpostor,\r\n      physicalProperties,\r\n      scene\r\n    );\r\n\r\n    return instance;\r\n  }\r\n\r\n  static getDicePhysicalProperties(diceType: DiceType) {\r\n    switch (diceType) {\r\n      case \"d4\":\r\n        return { mass: 4, friction: 4 };\r\n      case \"d6\":\r\n        return { mass: 6, friction: 4 };\r\n      case \"d8\":\r\n        return { mass: 6.2, friction: 4 };\r\n      case \"d10\":\r\n      case \"d100\":\r\n        return { mass: 7, friction: 4 };\r\n      case \"d12\":\r\n        return { mass: 8, friction: 4 };\r\n      case \"d20\":\r\n        return { mass: 10, friction: 4 };\r\n      default:\r\n        return { mass: 10, friction: 4 };\r\n    }\r\n  }\r\n\r\n  static roll(instance: InstancedMesh) {\r\n    instance.physicsImpostor?.setLinearVelocity(Vector3.Zero());\r\n    instance.physicsImpostor?.setAngularVelocity(Vector3.Zero());\r\n\r\n    const scene = instance.getScene();\r\n    const diceTraySingle = scene.getMeshByID(\"dice_tray_single\");\r\n    const diceTrayDouble = scene.getMeshByID(\"dice_tray_double\");\r\n    const visibleDiceTray = diceTraySingle?.isVisible\r\n      ? diceTraySingle\r\n      : diceTrayDouble;\r\n    if (!visibleDiceTray) {\r\n      throw new Error(\"No dice tray to roll in\");\r\n    }\r\n    const trayBounds = visibleDiceTray?.getBoundingInfo().boundingBox;\r\n\r\n    const position = new Vector3(\r\n      trayBounds.center.x + (Math.random() * 2 - 1),\r\n      8,\r\n      trayBounds.center.z + (Math.random() * 2 - 1)\r\n    );\r\n    instance.position = position;\r\n    instance.addRotation(\r\n      Math.random() * Math.PI * 2,\r\n      Math.random() * Math.PI * 2,\r\n      Math.random() * Math.PI * 2\r\n    );\r\n\r\n    const throwTarget = new Vector3(\r\n      lerp(trayBounds.minimumWorld.x, trayBounds.maximumWorld.x, Math.random()),\r\n      5,\r\n      lerp(trayBounds.minimumWorld.z, trayBounds.maximumWorld.z, Math.random())\r\n    );\r\n\r\n    const impulse = new Vector3(0, 0, 0)\r\n      .subtract(throwTarget)\r\n      .normalizeToNew()\r\n      .scale(lerp(minDiceRollSpeed, maxDiceRollSpeed, Math.random()));\r\n\r\n    instance.physicsImpostor?.applyImpulse(\r\n      impulse,\r\n      instance.physicsImpostor.getObjectCenter()\r\n    );\r\n  }\r\n\r\n  static createInstanceMesh(\r\n    mesh: Mesh,\r\n    physicalProperties: PhysicsImpostorParameters,\r\n    scene: Scene\r\n  ): InstancedMesh {\r\n    this.instanceCount++;\r\n\r\n    return this.createInstanceFromMesh(\r\n      mesh,\r\n      `dice_instance_${this.instanceCount}`,\r\n      physicalProperties,\r\n      scene\r\n    );\r\n  }\r\n\r\n  static async load(scene: Scene) {\r\n    throw new Error(`Unable to load ${scene}`);\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene): InstancedMesh {\r\n    throw new Error(`No instance available for ${diceType} in ${scene}`);\r\n  }\r\n}\r\n\r\nexport default Dice;\r\n","function ExpandMoreDotIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\r\n      <path d=\"M20.08,11.42l-4.04-5.65C15.7,5.29,15.15,5,14.56,5h0c-1.49,0-2.35,1.68-1.49,2.89L16,12l-2.93,4.11 c-0.87,1.21,0,2.89,1.49,2.89h0c0.59,0,1.15-0.29,1.49-0.77l4.04-5.65C20.33,12.23,20.33,11.77,20.08,11.42z\" />\r\n      <path d=\"M13.08,11.42L9.05,5.77C8.7,5.29,8.15,5,7.56,5h0C6.07,5,5.2,6.68,6.07,7.89L9,12l-2.93,4.11C5.2,17.32,6.07,19,7.56,19h0 c0.59,0,1.15-0.29,1.49-0.77l4.04-5.65C13.33,12.23,13.33,11.77,13.08,11.42z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ExpandMoreDotIcon;\r\n","function ShareDiceOnIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M24 24H0V0h24z\" fill=\"none\" />\r\n      <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ShareDiceOnIcon;\r\n","function ShareDiceOffIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M24 24H0V0h24z\" fill=\"none\" />\r\n      <path d=\"M11,8.17L6.49,3.66C8.07,2.61,9.96,2,12,2c5.52,0,10,4.48,10,10c0,2.04-0.61,3.93-1.66,5.51l-1.46-1.46 C19.59,14.87,20,13.48,20,12c0-3.35-2.07-6.22-5-7.41V5c0,1.1-0.9,2-2,2h-2V8.17z M20.49,21.9L20.49,21.9 c-0.39,0.39-1.02,0.39-1.41,0l-1.56-1.56c-2.07,1.37-4.68,2-7.45,1.48c-3.95-0.75-7.13-3.92-7.88-7.88 c-0.52-2.77,0.1-5.38,1.48-7.45L2.1,4.93c-0.39-0.39-0.39-1.02,0-1.41l0,0c0.39-0.39,1.02-0.39,1.41,0l16.97,16.97 C20.88,20.88,20.88,21.51,20.49,21.9z M11,18c-1.1,0-2-0.9-2-2v-1l-4.79-4.79C4.08,10.79,4,11.38,4,12c0,4.08,3.05,7.44,7,7.93V18z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ShareDiceOffIcon;\r\n","import React from \"react\";\r\nimport { Box, Text } from \"theme-ui\";\r\n\r\nfunction DiceButtonCount({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <Box\r\n      sx={{\r\n        position: \"absolute\",\r\n        top: \"50%\",\r\n        right: \"90%\",\r\n        transform: \"translateY(-50%)\",\r\n        height: \"14px\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n      }}\r\n    >\r\n      <Text\r\n        variant=\"caption\"\r\n        as=\"p\"\r\n        color=\"text\"\r\n        sx={{ fontSize: \"10px\", fontWeight: \"bold\" }}\r\n      >\r\n        {children}\r\n      </Text>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default DiceButtonCount;\r\n","import React from \"react\";\r\nimport { IconButton } from \"theme-ui\";\r\n\r\nimport Count from \"./DiceButtonCount\";\r\n\r\ntype DiceButtonProps = {\r\n  title: string;\r\n  children: React.ReactNode;\r\n  count?: number;\r\n  onClick: React.MouseEventHandler<HTMLButtonElement>;\r\n  disabled: boolean;\r\n};\r\n\r\nfunction DiceButton({\r\n  title,\r\n  children,\r\n  count,\r\n  onClick,\r\n  disabled,\r\n}: DiceButtonProps) {\r\n  return (\r\n    <IconButton\r\n      title={title}\r\n      aria-label={title}\r\n      onClick={onClick}\r\n      sx={{ position: \"relative\" }}\r\n      disabled={disabled}\r\n    >\r\n      {children}\r\n      {count && <Count>{count}</Count>}\r\n    </IconButton>\r\n  );\r\n}\r\n\r\nexport default DiceButton;\r\n","function SelectDiceIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SelectDiceIcon;\r\n","import { Image } from \"theme-ui\";\r\n\r\nimport Tile from \"../tile/Tile\";\r\n\r\nimport { DefaultDice } from \"../../types/Dice\";\r\n\r\ntype DiceTileProps = {\r\n  dice: DefaultDice;\r\n  isSelected: boolean;\r\n  onDiceSelect: (dice: DefaultDice) => void;\r\n  onDone: (dice: DefaultDice) => void;\r\n};\r\n\r\nfunction DiceTile({ dice, isSelected, onDiceSelect, onDone }: DiceTileProps) {\r\n  return (\r\n    <div style={{ cursor: \"pointer\" }}>\r\n      <Tile\r\n        title={dice.name}\r\n        isSelected={isSelected}\r\n        onSelect={() => onDiceSelect(dice)}\r\n        onDoubleClick={() => onDone(dice)}\r\n      >\r\n        <Image src={dice.preview}></Image>\r\n      </Tile>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default DiceTile;\r\n","import { Grid } from \"theme-ui\";\r\nimport SimpleBar from \"simplebar-react\";\r\n\r\nimport DiceTile from \"./DiceTile\";\r\n\r\nimport useResponsiveLayout from \"../../hooks/useResponsiveLayout\";\r\nimport { DefaultDice } from \"../../types/Dice\";\r\nimport { DiceSelectEventHandler } from \"../../types/Events\";\r\n\r\ntype DiceTileProps = {\r\n  dice: DefaultDice[];\r\n  onDiceSelect: DiceSelectEventHandler;\r\n  selectedDice: DefaultDice;\r\n  onDone: DiceSelectEventHandler;\r\n};\r\n\r\nfunction DiceTiles({\r\n  dice,\r\n  onDiceSelect,\r\n  selectedDice,\r\n  onDone,\r\n}: DiceTileProps) {\r\n  const layout = useResponsiveLayout();\r\n\r\n  return (\r\n    <SimpleBar style={{ height: layout.tileContainerHeight }}>\r\n      <Grid\r\n        p={2}\r\n        pb={4}\r\n        bg=\"muted\"\r\n        sx={{\r\n          borderRadius: \"4px\",\r\n          minHeight: layout.screenSize === \"large\" ? \"600px\" : \"400px\",\r\n        }}\r\n        gap={2}\r\n        columns={`repeat(${layout.tileGridColumns}, 1fr)`}\r\n      >\r\n        {dice.map((dice) => (\r\n          <DiceTile\r\n            key={dice.key}\r\n            dice={dice}\r\n            isSelected={selectedDice && dice.key === selectedDice.key}\r\n            onDiceSelect={onDiceSelect}\r\n            onDone={onDone}\r\n          />\r\n        ))}\r\n      </Grid>\r\n    </SimpleBar>\r\n  );\r\n}\r\n\r\nexport default DiceTiles;\r\n","export default __webpack_public_path__ + \"static/media/albedo.0940cfaf.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.8c8e9d34.jpg\";","export default __webpack_public_path__ + \"static/media/normal.97ba4b6c.jpg\";","import { InstancedMesh, Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass GalaxyDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"galaxy_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene): InstancedMesh {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return super.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default GalaxyDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.b76f6b3b.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.d42c24eb.jpg\";","export default __webpack_public_path__ + \"static/media/normal.19a9c078.jpg\";","import { Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass IronDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static getDicePhysicalProperties(diceType: DiceType) {\r\n    let properties = super.getDicePhysicalProperties(diceType);\r\n    return { mass: properties.mass * 2, friction: properties.friction };\r\n  }\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"iron_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return Dice.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default IronDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.5479454b.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.316a71be.jpg\";","export default __webpack_public_path__ + \"static/media/normal.0dc207c6.jpg\";","import { Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass NebulaDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"neubula_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return Dice.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default NebulaDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.83b2adf8.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.a6c7a8ac.jpg\";","export default __webpack_public_path__ + \"static/media/normal.75d74d42.jpg\";","import { Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass SunriseDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"sunrise_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return super.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default SunriseDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.989c2eb0.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.c7c91f0a.jpg\";","export default __webpack_public_path__ + \"static/media/normal.55affda5.jpg\";","import { Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass SunsetDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"sunset_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return super.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default SunsetDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.f961edb0.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.6fe2dde8.jpg\";","export default __webpack_public_path__ + \"static/media/normal.8143036b.jpg\";","import { Material, Scene } from \"@babylonjs/core\";\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport d4Source from \"./d4.glb\";\r\nimport d6Source from \"./d6.glb\";\r\nimport d8Source from \"./d8.glb\";\r\nimport d10Source from \"./d10.glb\";\r\nimport d12Source from \"./d12.glb\";\r\nimport d20Source from \"./d20.glb\";\r\nimport d100Source from \"./d100.glb\";\r\nimport { DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nconst sourceOverrides = {\r\n  d4: d4Source,\r\n  d6: d6Source,\r\n  d8: d8Source,\r\n  d10: d10Source,\r\n  d12: d12Source,\r\n  d20: d20Source,\r\n  d100: d100Source,\r\n};\r\n\r\nclass WalnutDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static getDicePhysicalProperties(diceType: DiceType) {\r\n    let properties = super.getDicePhysicalProperties(diceType);\r\n    return { mass: properties.mass * 1.4, friction: properties.friction };\r\n  }\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"walnut_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(\r\n        this.material,\r\n        scene,\r\n        sourceOverrides\r\n      );\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return super.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default WalnutDice;\r\n","export default __webpack_public_path__ + \"static/media/d4.52896fe7.glb\";","export default __webpack_public_path__ + \"static/media/d6.9192a151.glb\";","export default __webpack_public_path__ + \"static/media/d8.b80ce954.glb\";","export default __webpack_public_path__ + \"static/media/d10.8948845e.glb\";","export default __webpack_public_path__ + \"static/media/d12.8dc2ee51.glb\";","export default __webpack_public_path__ + \"static/media/d20.45aa4a95.glb\";","export default __webpack_public_path__ + \"static/media/d100.e871721f.glb\";","export default __webpack_public_path__ + \"static/media/albedo.e36ca17f.jpg\";","export default __webpack_public_path__ + \"static/media/mask.1f48bf2d.png\";","export default __webpack_public_path__ + \"static/media/normal.5e14e52f.jpg\";","import { PBRMaterial } from \"@babylonjs/core/Materials/PBR/pbrMaterial\";\r\nimport { Color3 } from \"@babylonjs/core/Maths/math\";\r\nimport { Material, Scene } from \"@babylonjs/core\";\r\n\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport mask from \"./mask.png\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { importTextureAsync } from \"../../helpers/babylon\";\r\n\r\nimport { BaseDiceTextureSources, DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\ntype GlassDiceTextureSources = Pick<\r\n  BaseDiceTextureSources,\r\n  \"albedo\" | \"normal\"\r\n> & { mask: string };\r\n\r\nclass GlassDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static getDicePhysicalProperties(diceType: DiceType) {\r\n    let properties = super.getDicePhysicalProperties(diceType);\r\n    return { mass: properties.mass * 1.5, friction: properties.friction };\r\n  }\r\n\r\n  static async loadGlassMaterial(\r\n    materialName: string,\r\n    textures: GlassDiceTextureSources,\r\n    scene: Scene\r\n  ) {\r\n    let pbr = new PBRMaterial(materialName, scene);\r\n    let [albedo, normal, mask] = await Promise.all([\r\n      importTextureAsync(textures.albedo),\r\n      importTextureAsync(textures.normal),\r\n      importTextureAsync(textures.mask),\r\n    ]);\r\n    pbr.albedoTexture = albedo;\r\n    pbr.bumpTexture = normal;\r\n    pbr.roughness = 0.25;\r\n    pbr.metallic = 0;\r\n    pbr.subSurface.isRefractionEnabled = true;\r\n    pbr.subSurface.indexOfRefraction = 2.0;\r\n    pbr.subSurface.refractionIntensity = 1.0;\r\n    pbr.subSurface.isTranslucencyEnabled = true;\r\n    pbr.subSurface.translucencyIntensity = 0.5;\r\n    pbr.subSurface.minimumThickness = 10;\r\n    pbr.subSurface.maximumThickness = 10;\r\n    pbr.subSurface.tintColor = new Color3(43 / 255, 1, 115 / 255);\r\n    pbr.subSurface.thicknessTexture = mask;\r\n    pbr.subSurface.useMaskFromThicknessTexture = true;\r\n\r\n    return pbr;\r\n  }\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadGlassMaterial(\r\n        \"glass_pbr\",\r\n        { albedo, mask, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return Dice.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default GlassDice;\r\n","export default __webpack_public_path__ + \"static/media/albedo.a5508be6.jpg\";","export default __webpack_public_path__ + \"static/media/metalRoughness.f8e641dc.jpg\";","export default __webpack_public_path__ + \"static/media/normal.4f52152c.jpg\";","import { PBRMaterial } from \"@babylonjs/core/Materials/PBR/pbrMaterial\";\r\nimport { Color3 } from \"@babylonjs/core/Maths/math\";\r\nimport { Material, Scene } from \"@babylonjs/core\";\r\n\r\nimport Dice from \"../Dice\";\r\n\r\nimport albedo from \"./albedo.jpg\";\r\nimport metalRoughness from \"./metalRoughness.jpg\";\r\nimport normal from \"./normal.jpg\";\r\n\r\nimport { importTextureAsync } from \"../../helpers/babylon\";\r\nimport { BaseDiceTextureSources, DiceMeshes, DiceType } from \"../../types/Dice\";\r\n\r\nclass GemstoneDice extends Dice {\r\n  static meshes: DiceMeshes;\r\n  static material: Material;\r\n\r\n  static getDicePhysicalProperties(diceType: DiceType) {\r\n    let properties = super.getDicePhysicalProperties(diceType);\r\n    return { mass: properties.mass * 1.5, friction: properties.friction };\r\n  }\r\n\r\n  static async loadMaterial(\r\n    materialName: string,\r\n    textures: BaseDiceTextureSources,\r\n    scene: Scene\r\n  ) {\r\n    let pbr = new PBRMaterial(materialName, scene);\r\n    let [albedo, normal, metalRoughness] = await Promise.all([\r\n      importTextureAsync(textures.albedo),\r\n      importTextureAsync(textures.normal),\r\n      importTextureAsync(textures.metalRoughness),\r\n    ]);\r\n    pbr.albedoTexture = albedo;\r\n    pbr.bumpTexture = normal;\r\n    pbr.metallicTexture = metalRoughness;\r\n    pbr.useRoughnessFromMetallicTextureAlpha = false;\r\n    pbr.useRoughnessFromMetallicTextureGreen = true;\r\n    pbr.useMetallnessFromMetallicTextureBlue = true;\r\n\r\n    pbr.subSurface.isTranslucencyEnabled = true;\r\n    pbr.subSurface.translucencyIntensity = 0.2;\r\n    pbr.subSurface.minimumThickness = 5;\r\n    pbr.subSurface.maximumThickness = 10;\r\n    pbr.subSurface.tintColor = new Color3(190 / 255, 0, 220 / 255);\r\n\r\n    return pbr;\r\n  }\r\n\r\n  static async load(scene: Scene) {\r\n    if (!this.material) {\r\n      this.material = await this.loadMaterial(\r\n        \"gemstone_pbr\",\r\n        { albedo, metalRoughness, normal },\r\n        scene\r\n      );\r\n    }\r\n    if (!this.meshes) {\r\n      this.meshes = await this.loadMeshes(this.material, scene);\r\n    }\r\n  }\r\n\r\n  static createInstance(diceType: DiceType, scene: Scene) {\r\n    if (!this.material || !this.meshes) {\r\n      throw Error(\"Dice not loaded, call load before creating an instance\");\r\n    }\r\n\r\n    return Dice.createInstanceMesh(\r\n      this.meshes[diceType],\r\n      this.getDicePhysicalProperties(diceType),\r\n      scene\r\n    );\r\n  }\r\n}\r\n\r\nexport default GemstoneDice;\r\n","export default __webpack_public_path__ + \"static/media/preview.90e03e4d.png\";","export default __webpack_public_path__ + \"static/media/preview.426a2aa1.png\";","export default __webpack_public_path__ + \"static/media/preview.797f7773.png\";","export default __webpack_public_path__ + \"static/media/preview.3f77b9e6.png\";","export default __webpack_public_path__ + \"static/media/preview.9a76b828.png\";","export default __webpack_public_path__ + \"static/media/preview.a548021a.png\";","export default __webpack_public_path__ + \"static/media/preview.7d921376.png\";","export default __webpack_public_path__ + \"static/media/preview.eb6266ff.png\";","import Case from \"case\";\r\n\r\nimport GalaxyDice from \"./galaxy/GalaxyDice\";\r\nimport IronDice from \"./iron/IronDice\";\r\nimport NebulaDice from \"./nebula/NebulaDice\";\r\nimport SunriseDice from \"./sunrise/SunriseDice\";\r\nimport SunsetDice from \"./sunset/SunsetDice\";\r\nimport WalnutDice from \"./walnut/WalnutDice\";\r\nimport GlassDice from \"./glass/GlassDice\";\r\nimport GemstoneDice from \"./gemstone/GemstoneDice\";\r\n\r\nimport GalaxyPreview from \"./galaxy/preview.png\";\r\nimport IronPreview from \"./iron/preview.png\";\r\nimport NebulaPreview from \"./nebula/preview.png\";\r\nimport SunrisePreview from \"./sunrise/preview.png\";\r\nimport SunsetPreview from \"./sunset/preview.png\";\r\nimport WalnutPreview from \"./walnut/preview.png\";\r\nimport GlassPreview from \"./glass/preview.png\";\r\nimport GemstonePreview from \"./gemstone/preview.png\";\r\nimport Dice from \"./Dice\";\r\n\r\nimport { DefaultDice } from \"../types/Dice\";\r\n\r\ntype DiceClasses = Record<string, typeof Dice>;\r\n\r\nexport const diceClasses: DiceClasses = {\r\n  galaxy: GalaxyDice,\r\n  nebula: NebulaDice,\r\n  sunrise: SunriseDice,\r\n  sunset: SunsetDice,\r\n  iron: IronDice,\r\n  walnut: WalnutDice,\r\n  glass: GlassDice,\r\n  gemstone: GemstoneDice,\r\n};\r\n\r\ntype DicePreview = Record<string, string>;\r\n\r\nexport const dicePreviews: DicePreview = {\r\n  galaxy: GalaxyPreview,\r\n  nebula: NebulaPreview,\r\n  sunrise: SunrisePreview,\r\n  sunset: SunsetPreview,\r\n  iron: IronPreview,\r\n  walnut: WalnutPreview,\r\n  glass: GlassPreview,\r\n  gemstone: GemstonePreview,\r\n};\r\n\r\nexport const dice: DefaultDice[] = Object.keys(diceClasses).map((key) => ({\r\n  key,\r\n  name: Case.capital(key),\r\n  class: diceClasses[key],\r\n  preview: dicePreviews[key],\r\n}));\r\n","import { useState } from \"react\";\r\nimport { Flex, Label, Button } from \"theme-ui\";\r\n\r\nimport Modal from \"../components/Modal\";\r\nimport DiceTiles from \"../components/dice/DiceTiles\";\r\n\r\nimport { dice } from \"../dice\";\r\n\r\nimport useResponsiveLayout from \"../hooks/useResponsiveLayout\";\r\n\r\nimport {\r\n  DiceSelectEventHandler,\r\n  RequestCloseEventHandler,\r\n} from \"../types/Events\";\r\nimport { DefaultDice } from \"../types/Dice\";\r\n\r\ntype SelectDiceProps = {\r\n  isOpen: boolean;\r\n  onRequestClose: RequestCloseEventHandler;\r\n  onDone: DiceSelectEventHandler;\r\n  defaultDice: DefaultDice;\r\n};\r\n\r\nfunction SelectDiceModal({\r\n  isOpen,\r\n  onRequestClose,\r\n  onDone,\r\n  defaultDice,\r\n}: SelectDiceProps) {\r\n  const [selectedDice, setSelectedDice] = useState(defaultDice);\r\n  const layout = useResponsiveLayout();\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={isOpen}\r\n      onRequestClose={onRequestClose}\r\n      style={{\r\n        content: { maxWidth: layout.modalSize, width: \"calc(100% - 16px)\" },\r\n      }}\r\n    >\r\n      <Flex\r\n        sx={{\r\n          flexDirection: \"column\",\r\n        }}\r\n      >\r\n        <Label pt={2} pb={1}>\r\n          Select a dice style\r\n        </Label>\r\n        <DiceTiles\r\n          dice={dice}\r\n          onDiceSelect={setSelectedDice}\r\n          selectedDice={selectedDice}\r\n          onDone={onDone}\r\n        />\r\n        <Button my={2} variant=\"primary\" onClick={() => onDone(selectedDice)}>\r\n          Select\r\n        </Button>\r\n      </Flex>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nexport default SelectDiceModal;\r\n","import { useState } from \"react\";\r\nimport { IconButton } from \"theme-ui\";\r\n\r\nimport SelectDiceIcon from \"../../icons/SelectDiceIcon\";\r\nimport SelectDiceModal from \"../../modals/SelectDiceModal\";\r\n\r\nimport { DefaultDice } from \"../../types/Dice\";\r\n\r\ntype SelectDiceButtonProps = {\r\n  onDiceChange: (dice: DefaultDice) => void;\r\n  currentDice: DefaultDice;\r\n  disabled: boolean;\r\n};\r\n\r\nfunction SelectDiceButton({\r\n  onDiceChange,\r\n  currentDice,\r\n  disabled,\r\n}: SelectDiceButtonProps) {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n  function openModal() {\r\n    setIsModalOpen(true);\r\n  }\r\n  function closeModal() {\r\n    setIsModalOpen(false);\r\n  }\r\n\r\n  function handleDone(dice: DefaultDice) {\r\n    onDiceChange(dice);\r\n    closeModal();\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        aria-label=\"Select Dice Style\"\r\n        title=\"Select Dice Style\"\r\n        onClick={openModal}\r\n        disabled={disabled}\r\n      >\r\n        <SelectDiceIcon />\r\n      </IconButton>\r\n      <SelectDiceModal\r\n        isOpen={isModalOpen}\r\n        onRequestClose={closeModal}\r\n        defaultDice={currentDice}\r\n        onDone={handleDone}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nSelectDiceButton.defaultProps = {\r\n  disabled: false,\r\n};\r\n\r\nexport default SelectDiceButton;\r\n","import { useState, useEffect } from \"react\";\r\nimport { Flex, IconButton, Box } from \"theme-ui\";\r\nimport SimpleBar from \"simplebar-react\";\r\n\r\nimport D20Icon from \"../../icons/D20Icon\";\r\nimport D12Icon from \"../../icons/D12Icon\";\r\nimport D10Icon from \"../../icons/D10Icon\";\r\nimport D8Icon from \"../../icons/D8Icon\";\r\nimport D6Icon from \"../../icons/D6Icon\";\r\nimport D4Icon from \"../../icons/D4Icon\";\r\nimport D100Icon from \"../../icons/D100Icon\";\r\nimport ExpandMoreDiceTrayIcon from \"../../icons/ExpandMoreDiceTrayIcon\";\r\nimport ShareDiceOnIcon from \"../../icons/ShareDiceOnIcon\";\r\nimport ShareDiceOffIcon from \"../../icons/ShareDiceOffIcon\";\r\n\r\nimport DiceButton from \"./DiceButton\";\r\nimport SelectDiceButton from \"./SelectDiceButton\";\r\n\r\nimport Divider from \"../Divider\";\r\n\r\nimport Dice from \"../../dice/Dice\";\r\n\r\nimport { dice } from \"../../dice\";\r\nimport useSetting from \"../../hooks/useSetting\";\r\n\r\nimport { DefaultDice, DiceRoll, DiceType } from \"../../types/Dice\";\r\nimport { DiceShareChangeEventHandler } from \"../../types/Events\";\r\n\r\ntype DiceButtonsProps = {\r\n  diceRolls: DiceRoll[];\r\n  onDiceAdd: (style: typeof Dice, type: DiceType) => void;\r\n  onDiceLoad: (dice: DefaultDice) => void;\r\n  diceTraySize: \"single\" | \"double\";\r\n  onDiceTraySizeChange: (newSize: \"single\" | \"double\") => void;\r\n  shareDice: boolean;\r\n  onShareDiceChange: DiceShareChangeEventHandler;\r\n  loading: boolean;\r\n};\r\n\r\nfunction DiceButtons({\r\n  diceRolls,\r\n  onDiceAdd,\r\n  onDiceLoad,\r\n  diceTraySize,\r\n  onDiceTraySizeChange,\r\n  shareDice,\r\n  onShareDiceChange,\r\n  loading,\r\n}: DiceButtonsProps) {\r\n  const [currentDiceStyle, setCurrentDiceStyle] = useSetting(\"dice.style\");\r\n  const [currentDice, setCurrentDice] = useState<DefaultDice>(\r\n    dice.find((d) => d.key === currentDiceStyle) || dice[0]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const initialDice = dice.find((d) => d.key === currentDiceStyle);\r\n    if (initialDice) {\r\n      onDiceLoad(initialDice);\r\n      setCurrentDice(initialDice);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const diceCounts: Partial<Record<DiceType, number>> = {};\r\n  for (let dice of diceRolls) {\r\n    if (dice.type in diceCounts) {\r\n      // TODO: Check type\r\n      diceCounts[dice.type]! += 1;\r\n    } else {\r\n      diceCounts[dice.type] = 1;\r\n    }\r\n  }\r\n\r\n  async function handleDiceChange(dice: DefaultDice) {\r\n    await onDiceLoad(dice);\r\n    setCurrentDice(dice);\r\n    setCurrentDiceStyle(dice.key);\r\n  }\r\n\r\n  let buttons = [\r\n    {\r\n      key: \"d20\",\r\n      title: \"Add D20\",\r\n      count: diceCounts.d20,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d20\"),\r\n      children: <D20Icon />,\r\n    },\r\n    {\r\n      key: \"d12\",\r\n      title: \"Add D12\",\r\n      count: diceCounts.d12,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d12\"),\r\n      children: <D12Icon />,\r\n    },\r\n    {\r\n      key: \"d10\",\r\n      title: \"Add D10\",\r\n      count: diceCounts.d10,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d10\"),\r\n      children: <D10Icon />,\r\n    },\r\n    {\r\n      key: \"d8\",\r\n      title: \"Add D8\",\r\n      count: diceCounts.d8,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d8\"),\r\n      children: <D8Icon />,\r\n    },\r\n    {\r\n      key: \"d6\",\r\n      title: \"Add D6\",\r\n      count: diceCounts.d6,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d6\"),\r\n      children: <D6Icon />,\r\n    },\r\n    {\r\n      key: \"d4\",\r\n      title: \"Add D4\",\r\n      count: diceCounts.d4,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d4\"),\r\n      children: <D4Icon />,\r\n    },\r\n    {\r\n      key: \"d100\",\r\n      title: \"Add D100\",\r\n      count: diceCounts.d100,\r\n      onClick: () => onDiceAdd(currentDice.class, \"d100\"),\r\n      children: <D100Icon />,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        borderRadius: \"4px\",\r\n        position: \"absolute\",\r\n        top: \"0\",\r\n        left: \"0\",\r\n        height: \"100%\",\r\n        maxHeight: \"390px\",\r\n        pointerEvents: \"all\",\r\n      }}\r\n      bg=\"overlay\"\r\n    >\r\n      <SimpleBar style={{ width: \"48px\", height: \"100%\" }}>\r\n        <Flex\r\n          sx={{\r\n            justifyContent: \"center\",\r\n            alignItems: \"center\",\r\n            flexDirection: \"column\",\r\n          }}\r\n          p={2}\r\n        >\r\n          <SelectDiceButton\r\n            onDiceChange={handleDiceChange}\r\n            currentDice={currentDice}\r\n            disabled={loading}\r\n          />\r\n          <Divider />\r\n          {buttons.map((button) => (\r\n            <DiceButton disabled={loading} {...button} />\r\n          ))}\r\n          <Divider />\r\n          <IconButton\r\n            aria-label={\r\n              diceTraySize === \"single\"\r\n                ? \"Expand Dice Tray\"\r\n                : \"Shrink Dice Tray\"\r\n            }\r\n            title={\r\n              diceTraySize === \"single\"\r\n                ? \"Expand Dice Tray\"\r\n                : \"Shrink Dice Tray\"\r\n            }\r\n            sx={{\r\n              transform:\r\n                diceTraySize === \"single\" ? \"rotate(0)\" : \"rotate(180deg)\",\r\n            }}\r\n            onClick={() =>\r\n              onDiceTraySizeChange(\r\n                diceTraySize === \"single\" ? \"double\" : \"single\"\r\n              )\r\n            }\r\n            disabled={loading}\r\n          >\r\n            <ExpandMoreDiceTrayIcon />\r\n          </IconButton>\r\n          <Divider />\r\n          <IconButton\r\n            aria-label={shareDice ? \"Hide Dice Rolls\" : \"Share Dice Rolls\"}\r\n            title={shareDice ? \"Hide Dice Rolls\" : \"Share Dice Rolls\"}\r\n            onClick={() => onShareDiceChange(!shareDice)}\r\n            disabled={loading}\r\n          >\r\n            {shareDice ? <ShareDiceOnIcon /> : <ShareDiceOffIcon />}\r\n          </IconButton>\r\n        </Flex>\r\n      </SimpleBar>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default DiceButtons;\r\n","function ClearDiceIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\r\n      <path d=\"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ClearDiceIcon;\r\n","function RerollDiceIcon() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      width=\"24\"\r\n      fill=\"currentcolor\"\r\n    >\r\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M21 14c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1l-.116-.007A1.004 1.004 0 0120 19v-1.01A9.985 9.985 0 0112 22c-4.36 0-8.07-2.79-9.44-6.69-.22-.64.28-1.31.96-1.31l.122.007a.991.991 0 01.818.633C5.55 17.76 8.51 20 12 20c2.95 0 5.53-1.61 6.91-4H17c-.55 0-1-.45-1-1l.007-.116c.058-.496.482-.884.993-.884zm-7-5a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4zm-1 3a1 1 0 100 2 1 1 0 000-2zm-2-2a1 1 0 100 2 1 1 0 000-2zm1-8c4.36 0 8.07 2.79 9.44 6.69.22.64-.28 1.31-.96 1.31l-.122-.007a.991.991 0 01-.818-.633C18.45 6.24 15.49 4 12 4 9.05 4 6.47 5.61 5.09 8H7c.55 0 1 .45 1 1l-.007.116A1.004 1.004 0 017 10H3c-.55 0-1-.45-1-1V5c0-.55.45-1 1-1l.116.007C3.612 4.065 4 4.489 4 5v1.01A9.985 9.985 0 0112 2z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default RerollDiceIcon;\r\n","import React, { useState } from \"react\";\r\nimport { Flex, Text, Button, IconButton } from \"theme-ui\";\r\n\r\nimport ClearDiceIcon from \"../../icons/ClearDiceIcon\";\r\nimport RerollDiceIcon from \"../../icons/RerollDiceIcon\";\r\n\r\nimport { getDiceRollTotal } from \"../../helpers/dice\";\r\nimport { DiceRoll } from \"../../types/Dice\";\r\n\r\nconst maxDiceRollsShown = 6;\r\n\r\ntype DiceResultsProps = {\r\n  diceRolls: DiceRoll[];\r\n  onDiceClear: () => void;\r\n  onDiceReroll: () => void;\r\n};\r\n\r\nfunction DiceResults({\r\n  diceRolls,\r\n  onDiceClear,\r\n  onDiceReroll,\r\n}: DiceResultsProps) {\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n  if (diceRolls.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  let rolls: React.ReactChild[] = [];\r\n  if (diceRolls.length > 1) {\r\n    rolls = diceRolls\r\n      .filter((dice) => dice.roll !== \"unknown\")\r\n      .map((dice, index) => (\r\n        <React.Fragment key={index}>\r\n          <Text variant=\"body2\" as=\"p\" color=\"hsl(210, 50%, 96%)\">\r\n            {dice.roll}\r\n          </Text>\r\n          <Text variant=\"body2\" as=\"p\" color=\"grey\">\r\n            {index === diceRolls.length - 1 ? \"\" : \"+\"}\r\n          </Text>\r\n        </React.Fragment>\r\n      ));\r\n  }\r\n\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n        position: \"absolute\",\r\n        bottom: \"5%\",\r\n        left: 0,\r\n        right: 0,\r\n        display: \"flex\",\r\n        color: \"white\",\r\n        pointerEvents: \"none\",\r\n      }}\r\n    >\r\n      <IconButton\r\n        ml=\"7%\"\r\n        title=\"Clear Dice\"\r\n        aria-label=\"Clear Dice\"\r\n        onClick={onDiceClear}\r\n        sx={{ pointerEvents: \"all\" }}\r\n      >\r\n        <ClearDiceIcon />\r\n      </IconButton>\r\n      <Flex\r\n        sx={{\r\n          flexDirection: \"column\",\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n        }}\r\n      >\r\n        <Text\r\n          variant=\"heading\"\r\n          as=\"h1\"\r\n          sx={{ fontSize: 5, userSelect: \"none\" }}\r\n        >\r\n          {getDiceRollTotal(diceRolls)}\r\n        </Text>\r\n        {rolls.length > maxDiceRollsShown ? (\r\n          <Button\r\n            aria-label={\"Show Dice Details\"}\r\n            title={\"Show Dice Details\"}\r\n            onClick={() => setIsExpanded(!isExpanded)}\r\n            variant=\"secondary\"\r\n            sx={{ display: \"flex\", height: \"24px\", pointerEvents: \"all\" }}\r\n          >\r\n            {isExpanded ? rolls : rolls.slice(0, maxDiceRollsShown)}\r\n            {!isExpanded && (\r\n              <Text variant=\"body2\" as=\"p\" color=\"hsl(210, 50%, 96%)\">\r\n                ...\r\n              </Text>\r\n            )}\r\n          </Button>\r\n        ) : (\r\n          <Flex sx={{ height: \"15px\" }}>{rolls}</Flex>\r\n        )}\r\n      </Flex>\r\n      <IconButton\r\n        mr=\"7%\"\r\n        title=\"Reroll Dice\"\r\n        aria-label=\"Reroll Dice\"\r\n        onClick={onDiceReroll}\r\n        sx={{ pointerEvents: \"all\" }}\r\n      >\r\n        <RerollDiceIcon />\r\n      </IconButton>\r\n    </Flex>\r\n  );\r\n}\r\n\r\nexport default DiceResults;\r\n","export default __webpack_public_path__ + \"static/media/single.2189bc7f.glb\";","export default __webpack_public_path__ + \"static/media/double.c0c4c48c.glb\";","export default __webpack_public_path__ + \"static/media/singleAlbedo.21816ea7.jpg\";","export default __webpack_public_path__ + \"static/media/singleMetalRoughness.7be5048e.jpg\";","export default __webpack_public_path__ + \"static/media/singleNormal.a88cbe7c.jpg\";","export default __webpack_public_path__ + \"static/media/doubleAlbedo.6c6fc3c8.jpg\";","export default __webpack_public_path__ + \"static/media/doubleMetalRoughness.29559b2e.jpg\";","export default __webpack_public_path__ + \"static/media/doubleNormal.9aaec73b.jpg\";","import { SceneLoader } from \"@babylonjs/core/Loading/sceneLoader\";\r\nimport { PBRMaterial } from \"@babylonjs/core/Materials/PBR/pbrMaterial\";\r\nimport { PhysicsImpostor } from \"@babylonjs/core/Physics/physicsImpostor\";\r\nimport { Mesh } from \"@babylonjs/core/Meshes/mesh\";\r\nimport { AbstractMesh, Scene, ShadowGenerator } from \"@babylonjs/core\";\r\n\r\nimport singleMeshSource from \"./single.glb\";\r\nimport doubleMeshSource from \"./double.glb\";\r\n\r\nimport singleAlbedo from \"./singleAlbedo.jpg\";\r\nimport singleMetalRoughness from \"./singleMetalRoughness.jpg\";\r\nimport singleNormal from \"./singleNormal.jpg\";\r\n\r\nimport doubleAlbedo from \"./doubleAlbedo.jpg\";\r\nimport doubleMetalRoughness from \"./doubleMetalRoughness.jpg\";\r\nimport doubleNormal from \"./doubleNormal.jpg\";\r\n\r\nimport { importTextureAsync } from \"../../helpers/babylon\";\r\n\r\nclass DiceTray {\r\n  _size;\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(newSize) {\r\n    this._size = newSize;\r\n    const wallOffsetWidth = this.collisionSize / 2 + this.width / 2 - 0.5;\r\n    const wallOffsetHeight = this.collisionSize / 2 + this.height / 2 - 0.5;\r\n    if (this.wallTop) this.wallTop.position.z = -wallOffsetHeight;\r\n    if (this.wallRight) this.wallRight.position.x = -wallOffsetWidth;\r\n    if (this.wallBottom) this.wallBottom.position.z = wallOffsetHeight;\r\n    if (this.wallLeft) this.wallLeft.position.x = wallOffsetWidth;\r\n    if (this.singleMesh) this.singleMesh.isVisible = newSize === \"single\";\r\n    if (this.doubleMesh) this.doubleMesh.isVisible = newSize === \"double\";\r\n  }\r\n\r\n  scene;\r\n  shadowGenerator;\r\n\r\n  get width() {\r\n    return this.size === \"single\" ? 10 : 20;\r\n  }\r\n\r\n  height = 20;\r\n  collisionSize = 50;\r\n  wallTop?: Mesh;\r\n  wallRight?: Mesh;\r\n  wallBottom?: Mesh;\r\n  wallLeft?: Mesh;\r\n  singleMesh?: AbstractMesh;\r\n  doubleMesh?: AbstractMesh;\r\n\r\n  constructor(\r\n    initialSize: string,\r\n    scene: Scene,\r\n    shadowGenerator: ShadowGenerator\r\n  ) {\r\n    this._size = initialSize;\r\n    this.scene = scene;\r\n    this.shadowGenerator = shadowGenerator;\r\n  }\r\n\r\n  async load() {\r\n    this.loadWalls();\r\n    await this.loadMeshes();\r\n  }\r\n\r\n  createCollision(\r\n    name: string,\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n    friction: number\r\n  ): Mesh {\r\n    let collision = Mesh.CreateBox(\r\n      name,\r\n      this.collisionSize,\r\n      this.scene,\r\n      true,\r\n      Mesh.DOUBLESIDE\r\n    );\r\n    collision.position.x = x;\r\n    collision.position.y = y;\r\n    collision.position.z = z;\r\n    collision.physicsImpostor = new PhysicsImpostor(\r\n      collision,\r\n      PhysicsImpostor.BoxImpostor,\r\n      { mass: 0, friction: friction },\r\n      this.scene\r\n    );\r\n    collision.isVisible = false;\r\n\r\n    return collision;\r\n  }\r\n\r\n  loadWalls() {\r\n    const wallOffsetWidth = this.collisionSize / 2 + this.width / 2 - 0.5;\r\n    const wallOffsetHeight = this.collisionSize / 2 + this.height / 2 - 0.5;\r\n    this.wallTop = this.createCollision(\"wallTop\", 0, 0, -wallOffsetHeight, 10);\r\n    this.wallRight = this.createCollision(\r\n      \"wallRight\",\r\n      -wallOffsetWidth,\r\n      0,\r\n      0,\r\n      10\r\n    );\r\n    this.wallBottom = this.createCollision(\r\n      \"wallBottom\",\r\n      0,\r\n      0,\r\n      wallOffsetHeight,\r\n      10\r\n    );\r\n    this.wallLeft = this.createCollision(\"wallLeft\", wallOffsetWidth, 0, 0, 10);\r\n    const diceTrayGroundOffset = 0.32;\r\n    this.createCollision(\r\n      \"ground\",\r\n      0,\r\n      -this.collisionSize / 2 + diceTrayGroundOffset,\r\n      0,\r\n      20\r\n    );\r\n    const diceTrayRoofOffset = 10;\r\n    this.createCollision(\r\n      \"roof\",\r\n      0,\r\n      this.collisionSize / 2 + diceTrayRoofOffset,\r\n      0,\r\n      100\r\n    );\r\n  }\r\n\r\n  async loadMeshes() {\r\n    let [\r\n      singleMeshes,\r\n      doubleMeshes,\r\n      singleAlbedoTexture,\r\n      singleNormalTexture,\r\n      singleMetalRoughnessTexture,\r\n      doubleAlbedoTexture,\r\n      doubleNormalTexture,\r\n      doubleMetalRoughnessTexture,\r\n    ] = await Promise.all([\r\n      SceneLoader.ImportMeshAsync(\"\", singleMeshSource, \"\", this.scene),\r\n      SceneLoader.ImportMeshAsync(\"\", doubleMeshSource, \"\", this.scene),\r\n      importTextureAsync(singleAlbedo),\r\n      importTextureAsync(singleNormal),\r\n      importTextureAsync(singleMetalRoughness),\r\n      importTextureAsync(doubleAlbedo),\r\n      importTextureAsync(doubleNormal),\r\n      importTextureAsync(doubleMetalRoughness),\r\n    ]);\r\n\r\n    this.singleMesh = singleMeshes.meshes[1];\r\n    this.singleMesh.id = \"dice_tray_single\";\r\n    this.singleMesh.name = \"dice_tray\";\r\n    let singleMaterial = new PBRMaterial(\"dice_tray_mat_single\", this.scene);\r\n    singleMaterial.albedoTexture = singleAlbedoTexture;\r\n    singleMaterial.bumpTexture = singleNormalTexture;\r\n    singleMaterial.metallicTexture = singleMetalRoughnessTexture;\r\n    singleMaterial.useRoughnessFromMetallicTextureAlpha = false;\r\n    singleMaterial.useRoughnessFromMetallicTextureGreen = true;\r\n    singleMaterial.useMetallnessFromMetallicTextureBlue = true;\r\n    this.singleMesh.material = singleMaterial;\r\n\r\n    this.singleMesh.receiveShadows = true;\r\n    this.shadowGenerator.addShadowCaster(this.singleMesh);\r\n    this.singleMesh.isVisible = this.size === \"single\";\r\n\r\n    this.doubleMesh = doubleMeshes.meshes[1];\r\n    this.doubleMesh.id = \"dice_tray_double\";\r\n    this.doubleMesh.name = \"dice_tray\";\r\n    let doubleMaterial = new PBRMaterial(\"dice_tray_mat_double\", this.scene);\r\n    doubleMaterial.albedoTexture = doubleAlbedoTexture;\r\n    doubleMaterial.bumpTexture = doubleNormalTexture;\r\n    doubleMaterial.metallicTexture = doubleMetalRoughnessTexture;\r\n    doubleMaterial.useRoughnessFromMetallicTextureAlpha = false;\r\n    doubleMaterial.useRoughnessFromMetallicTextureGreen = true;\r\n    doubleMaterial.useMetallnessFromMetallicTextureBlue = true;\r\n    this.doubleMesh.material = doubleMaterial;\r\n\r\n    this.doubleMesh.receiveShadows = true;\r\n    this.shadowGenerator.addShadowCaster(this.doubleMesh);\r\n    this.doubleMesh.isVisible = this.size === \"double\";\r\n  }\r\n}\r\n\r\nexport default DiceTray;\r\n","import { useRef, useCallback, useEffect, useState } from \"react\";\r\nimport { Vector3 } from \"@babylonjs/core/Maths/math\";\r\nimport { DirectionalLight } from \"@babylonjs/core/Lights/directionalLight\";\r\nimport { ShadowGenerator } from \"@babylonjs/core/Lights/Shadows/shadowGenerator\";\r\nimport { CubeTexture } from \"@babylonjs/core/Materials/Textures/cubeTexture\";\r\nimport { Scene } from \"@babylonjs/core\";\r\nimport { Box } from \"theme-ui\";\r\n\r\n// @ts-ignore\r\nimport environment from \"../../dice/environment.dds\";\r\n\r\nimport DiceInteraction from \"./DiceInteraction\";\r\nimport Dice from \"../../dice/Dice\";\r\nimport LoadingOverlay from \"../LoadingOverlay\";\r\nimport DiceButtons from \"./DiceButtons\";\r\nimport DiceResults from \"./DiceResults\";\r\n\r\nimport DiceTray from \"../../dice/diceTray/DiceTray\";\r\n\r\nimport { useDiceLoading } from \"../../contexts/DiceLoadingContext\";\r\n\r\nimport { getDiceRoll } from \"../../helpers/dice\";\r\n\r\nimport useSetting from \"../../hooks/useSetting\";\r\n\r\nimport { DefaultDice, DiceMesh, DiceRoll, DiceType } from \"../../types/Dice\";\r\nimport {\r\n  DiceRollsChangeEventHandler,\r\n  DiceShareChangeEventHandler,\r\n} from \"../../types/Events\";\r\n\r\ntype DiceTrayOverlayProps = {\r\n  isOpen: boolean;\r\n  shareDice: boolean;\r\n  onShareDiceChange: DiceShareChangeEventHandler;\r\n  diceRolls: DiceRoll[];\r\n  onDiceRollsChange: DiceRollsChangeEventHandler;\r\n};\r\n\r\nfunction DiceTrayOverlay({\r\n  isOpen,\r\n  shareDice,\r\n  onShareDiceChange,\r\n  diceRolls,\r\n  onDiceRollsChange,\r\n}: DiceTrayOverlayProps) {\r\n  const sceneRef = useRef<Scene>();\r\n  const shadowGeneratorRef = useRef<ShadowGenerator>();\r\n  const diceRefs = useRef<DiceMesh[]>([]);\r\n  const sceneVisibleRef = useRef(false);\r\n  const sceneInteractionRef = useRef(false);\r\n  // Add to the counter to ingore sleep values\r\n  const sceneKeepAwakeRef = useRef(0);\r\n  const diceTrayRef = useRef<DiceTray>();\r\n\r\n  const [diceTraySize, setDiceTraySize] =\r\n    useState<\"single\" | \"double\">(\"single\");\r\n  const { assetLoadStart, assetLoadFinish, isLoading } = useDiceLoading();\r\n  const [fullScreen] = useSetting(\"map.fullScreen\");\r\n\r\n  function handleAssetLoadStart() {\r\n    assetLoadStart();\r\n  }\r\n\r\n  function handleAssetLoadFinish() {\r\n    assetLoadFinish();\r\n    forceRender();\r\n  }\r\n\r\n  // Forces rendering for 1 second\r\n  function forceRender(): () => void {\r\n    // Force rerender\r\n    sceneKeepAwakeRef.current++;\r\n    let triggered = false;\r\n    let timeout = setTimeout(() => {\r\n      sceneKeepAwakeRef.current--;\r\n      triggered = true;\r\n    }, 1000);\r\n\r\n    return () => {\r\n      clearTimeout(timeout);\r\n      if (!triggered) {\r\n        sceneKeepAwakeRef.current--;\r\n      }\r\n    };\r\n  }\r\n\r\n  // Force render when changing dice tray size\r\n  useEffect(() => {\r\n    const diceTray = diceTrayRef.current;\r\n    let cleanup;\r\n    if (diceTray) {\r\n      diceTray.size = diceTraySize;\r\n      cleanup = forceRender();\r\n    }\r\n    return cleanup;\r\n  }, [diceTraySize]);\r\n\r\n  useEffect(() => {\r\n    let cleanup;\r\n    if (isOpen) {\r\n      sceneVisibleRef.current = true;\r\n      cleanup = forceRender();\r\n    } else {\r\n      sceneVisibleRef.current = false;\r\n    }\r\n\r\n    return cleanup;\r\n  }, [isOpen]);\r\n\r\n  const handleSceneMount = useCallback(async ({ scene, engine }) => {\r\n    sceneRef.current = scene;\r\n    await initializeScene(scene);\r\n    engine.runRenderLoop(() => update(scene));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function initializeScene(scene: Scene) {\r\n    handleAssetLoadStart();\r\n    let light = new DirectionalLight(\r\n      \"DirectionalLight\",\r\n      new Vector3(-0.5, -1, -0.5),\r\n      scene\r\n    );\r\n    light.position = new Vector3(5, 10, 5);\r\n    light.shadowMinZ = 1;\r\n    light.shadowMaxZ = 50;\r\n    let shadowGenerator = new ShadowGenerator(1024, light);\r\n    shadowGenerator.useCloseExponentialShadowMap = true;\r\n    shadowGenerator.darkness = 0.7;\r\n    shadowGeneratorRef.current = shadowGenerator;\r\n\r\n    scene.environmentTexture = CubeTexture.CreateFromPrefilteredData(\r\n      environment,\r\n      scene\r\n    );\r\n    scene.environmentIntensity = 1.0;\r\n\r\n    let diceTray = new DiceTray(\"single\", scene, shadowGenerator);\r\n    await diceTray.load();\r\n    diceTrayRef.current = diceTray;\r\n    handleAssetLoadFinish();\r\n  }\r\n\r\n  function update(scene: Scene) {\r\n    function getDiceSpeed(dice: DiceMesh) {\r\n      const diceSpeed =\r\n        dice.instance.physicsImpostor?.getLinearVelocity()?.length() || 0;\r\n      // If the dice is a d100 check the d10 as well\r\n      if (dice.d10Instance) {\r\n        const d10Speed =\r\n          dice.d10Instance.physicsImpostor?.getLinearVelocity()?.length() || 0;\r\n        return Math.max(diceSpeed, d10Speed);\r\n      } else {\r\n        return diceSpeed;\r\n      }\r\n    }\r\n\r\n    const die = diceRefs.current;\r\n    const sceneVisible = sceneVisibleRef.current;\r\n    if (!sceneVisible) {\r\n      return;\r\n    }\r\n    const forceSceneRender = sceneKeepAwakeRef.current > 0;\r\n    const sceneInteraction = sceneInteractionRef.current;\r\n    const diceAwake = die.map((dice) => dice.asleep).includes(false);\r\n    // Return early if scene doesn't need to be re-rendered\r\n    if (!forceSceneRender && !sceneInteraction && !diceAwake) {\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < die.length; i++) {\r\n      const dice = die[i];\r\n      const speed = getDiceSpeed(dice);\r\n      // If the speed has been below 0.01 for 1s set dice to sleep\r\n      if (speed < 0.01 && !dice.sleepTimeout) {\r\n        dice.sleepTimeout = setTimeout(() => {\r\n          dice.asleep = true;\r\n        }, 1000);\r\n      } else if (speed > 0.5 && (dice.asleep || dice.sleepTimeout)) {\r\n        dice.asleep = false;\r\n        dice.sleepTimeout && clearTimeout(dice.sleepTimeout);\r\n        dice.sleepTimeout = undefined;\r\n      }\r\n    }\r\n\r\n    if (scene) {\r\n      scene.render();\r\n    }\r\n  }\r\n\r\n  function handleDiceAdd(style: typeof Dice, type: DiceType) {\r\n    const scene = sceneRef.current;\r\n    const shadowGenerator = shadowGeneratorRef.current;\r\n    if (scene && shadowGenerator) {\r\n      const instance = style.createInstance(type, scene);\r\n      shadowGenerator.addShadowCaster(instance);\r\n      style.roll(instance);\r\n      let dice: DiceMesh = { type, instance, asleep: false };\r\n      // If we have a d100 add a d10 as well\r\n      if (type === \"d100\") {\r\n        const d10Instance = style.createInstance(\"d10\", scene);\r\n        shadowGenerator.addShadowCaster(d10Instance);\r\n        Dice.roll(d10Instance);\r\n        dice.d10Instance = d10Instance;\r\n      }\r\n      diceRefs.current.push(dice);\r\n    }\r\n  }\r\n\r\n  function handleDiceClear() {\r\n    const die = diceRefs.current;\r\n    for (let dice of die) {\r\n      dice.instance.dispose();\r\n      if (dice.d10Instance) {\r\n        dice.d10Instance.dispose();\r\n      }\r\n    }\r\n    diceRefs.current = [];\r\n    forceRender();\r\n  }\r\n\r\n  function handleDiceReroll() {\r\n    const die = diceRefs.current;\r\n    for (let dice of die) {\r\n      Dice.roll(dice.instance);\r\n      if (dice.d10Instance) {\r\n        Dice.roll(dice.d10Instance);\r\n      }\r\n      dice.asleep = false;\r\n    }\r\n  }\r\n\r\n  async function handleDiceLoad(dice: DefaultDice) {\r\n    handleAssetLoadStart();\r\n    const scene = sceneRef.current;\r\n    if (scene) {\r\n      await dice.class.load(scene);\r\n    }\r\n    handleAssetLoadFinish();\r\n  }\r\n\r\n  const [traySize, setTraySize] = useState({\r\n    width: 0,\r\n    height: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    let renderTimeout: NodeJS.Timeout;\r\n    let renderCleanup: () => void;\r\n    function handleResize() {\r\n      const map = document.querySelector(\".map\");\r\n      if (!map) {\r\n        return;\r\n      }\r\n      const mapRect = map.getBoundingClientRect();\r\n\r\n      const availableWidth = mapRect.width - 108; // Subtract padding\r\n      const availableHeight = mapRect.height - 80; // Subtract paddding and open icon\r\n\r\n      let height = Math.min(availableHeight, 1000);\r\n      let width = diceTraySize === \"single\" ? height / 2 : height;\r\n\r\n      if (width > availableWidth) {\r\n        width = availableWidth;\r\n        height = diceTraySize === \"single\" ? width * 2 : width;\r\n      }\r\n\r\n      // Debounce a timeout to force re-rendering on resize\r\n      renderTimeout = setTimeout(() => {\r\n        renderCleanup = forceRender();\r\n      }, 100);\r\n\r\n      setTraySize({ width, height });\r\n    }\r\n\r\n    window.addEventListener(\"resize\", handleResize);\r\n\r\n    handleResize();\r\n\r\n    return () => {\r\n      window.removeEventListener(\"resize\", handleResize);\r\n      if (renderTimeout) {\r\n        clearTimeout(renderTimeout);\r\n      }\r\n      if (renderCleanup) {\r\n        renderCleanup();\r\n      }\r\n    };\r\n  }, [diceTraySize, fullScreen, isOpen]);\r\n\r\n  // Update dice rolls\r\n  useEffect(() => {\r\n    function updateDiceRolls() {\r\n      const die = diceRefs.current;\r\n      const sceneVisible = sceneVisibleRef.current;\r\n      if (!sceneVisible) {\r\n        return;\r\n      }\r\n      const diceAwake = die.map((dice) => dice.asleep).includes(false);\r\n      if (!diceAwake) {\r\n        return;\r\n      }\r\n\r\n      let newRolls: DiceRoll[] = [];\r\n      for (let i = 0; i < die.length; i++) {\r\n        const dice = die[i];\r\n        let roll = getDiceRoll(dice);\r\n        newRolls[i] = roll;\r\n      }\r\n      onDiceRollsChange(newRolls);\r\n    }\r\n\r\n    const updateInterval = setInterval(updateDiceRolls, 100);\r\n    return () => {\r\n      clearInterval(updateInterval);\r\n    };\r\n  }, [diceRefs, sceneVisibleRef, onDiceRollsChange]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        width: `${traySize.width}px`,\r\n        height: `${traySize.height}px`,\r\n        borderRadius: \"4px\",\r\n        display: isOpen ? \"block\" : \"none\",\r\n        position: \"relative\",\r\n        overflow: \"visible\",\r\n      }}\r\n    >\r\n      <Box\r\n        sx={{\r\n          transform: \"translateX(50px)\",\r\n          width: \"100%\",\r\n          height: \"100%\",\r\n          pointerEvents: \"all\",\r\n        }}\r\n      >\r\n        <DiceInteraction\r\n          onSceneMount={handleSceneMount}\r\n          onPointerDown={() => {\r\n            sceneInteractionRef.current = true;\r\n          }}\r\n          onPointerUp={() => {\r\n            sceneInteractionRef.current = false;\r\n          }}\r\n        />\r\n        <DiceResults\r\n          diceRolls={diceRolls}\r\n          onDiceClear={() => {\r\n            handleDiceClear();\r\n            onDiceRollsChange([]);\r\n          }}\r\n          onDiceReroll={handleDiceReroll}\r\n        />\r\n      </Box>\r\n      <DiceButtons\r\n        diceRolls={diceRolls}\r\n        onDiceAdd={(style, type) => {\r\n          handleDiceAdd(style, type);\r\n          onDiceRollsChange([...diceRolls, { type, roll: \"unknown\" }]);\r\n        }}\r\n        onDiceLoad={handleDiceLoad}\r\n        onDiceTraySizeChange={setDiceTraySize}\r\n        diceTraySize={diceTraySize}\r\n        shareDice={shareDice}\r\n        onShareDiceChange={onShareDiceChange}\r\n        loading={isLoading}\r\n      />\r\n      {isLoading && (\r\n        <Box\r\n          sx={{\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: \"50px\",\r\n          }}\r\n        >\r\n          <LoadingOverlay />\r\n        </Box>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default DiceTrayOverlay;\r\n"],"sourceRoot":""}